# Configuracion de plantilla para los proyectos
> Ayuda: Documentacion de Redhat - Seccion: Post-Installation - Capitulo 3.1.8


Generar el fichero del template
  
    oc adm create-bootstrap-proejct-template -o yaml > template.yaml


### Agregar Network Policies
> Ayuda: Documentacion de redhat - Seccion Post-Installation - Capitulo 3.1.6
> Ayuda: Documentacion de redhat - Seccion Networking - Capitulo 9
> Ayuda: Se puede tomar una plantilla inicial desde la WebConsole

Se trata de establecer reglas de comunicacion entre proyectos e inclusive Pods. Para ello necesitamos crear una fichero yaml con la definicion.

    kind: NetworkPolicy
    apiVersion: networking.k8s.io/v1
    metadata:
      name: deny-by-default
    ...
    ...
    spec:
      podSelector:               <---- El destino del trafico. En este caso es a todos los pods
      ingress: []                <---- El trafico entrante. En este caso no hay definido trafico entrante permitido.
  
  
    kind: NetworkPolicy
    apiVersion: networking.k8s.io/v1
    metadata:
      name: deny-by-default
    ...
    ...
    spec:
      podSelector:               <---- El dESTINO del trafico. DESTINO PODS
        matchLabels:
          key: value             <---- En este caso es a todos los pods que tengan la etiqueta **key: value**
      ingress:                   
        namespaceSelector:       <---- El trafico entrante.    ORIGIN NAMESPACE
          matchLabels:
            key: vallue          <---- En este caso se permite trafico entrante desde el namespace con etiqueta **key: value**

Se pueden definir mas de una regla para el trafico entrante y saliente utilizando los operadores intrinsicos AND y OR

* Regla 1 AND Regla 2

* Regla 1 OR Regla 2

Esto se logra utilizando listas o no:

Cuando es una lista el OCP usa el operador **AND**, se deben cumplir ambas reglas

      ingress:                     <---- ORIGIN NAMESPACE
        - namespaceSelector:    
            matchLabels:
              key: vallue          
          podSelector:              <---- ORIGEN POD
            matchLabels:
              key: value

Cuando son listas independientes el OCP usa el operador **OR**, se deben cumplir caulquiera de las 2 reglas

      ingress:                     <---- ORIGIN NAMESPACE
        - namespaceSelector:    
            matchLabels:
              key: vallue          
        - podSelecto:              <---- ORIGIN POD
            matchLabels:
              key: value

Sabiendo esto, podemos agregar las politicas en el template como parte de la lista de objetos definidos. Agregando "-".

La politica mas utilizada durante los adiestramientos son aquellas para configurar la red Multitenant. **Estas politicas estan bien explicadas en Documentacion de redhat - Seccion Post-Installation - Capitulo 3.1.6**


### Agregar LimitRanges



### Agregar Quotas

## Montar Plantilla de Proyecto para que el api-Server la pueda usar.

Luego de modificar el template, se crea el recurso dentro del proyecto **openshift-config**

    oc create -f template.yaml -n openshift-config

Decirle a Openshift que use la nueva plantilla

    oc edit project.config.openshift.io/cluster
  
Se agrega en la seccion de spec, lo siguiente:

    apiVersion: config.openshift.io/v1
    kind: Project
    metadata:
      ...
    spec:
      projectRequestTemplate:
        name: <template_name>
        
Verificar que los **Pods** del apiserver, deben reiniciarse para tomar los cambios:

    watch oc get pods -n openshift-apiserver
    
Crear un proyecto para verificar que tome los cambios establecidos.

    oc get networkplicy,limitrange,resourcequota
    
    oc get project/<nom-proj> --show-labels
